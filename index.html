<html>

<head>
    <title>Main</title>
</head>

<body>
    <script>
        /**
        * Define element selector function 
        */
        var $ = function (id) {
            return document.getElementById(id);
        };
        /**
        * URL �붿껌�� ���� �묐떟�� 諛쏆븘�� 媛앹껜 
        */
        var request;

        /** 
        * 釉뚮씪�곗졇 蹂� request 媛앹껜 �앹꽦�� �꾪븳 Wrapper function
        * @param regType HTTP �붿껌 �좏삎. GET �먮뒗 POST
        * @param url �붿껌URL
        * @param async �숆린 �먮뒗 鍮꾨룞湲� 紐⑤뱶 �좏깮
        * @param queryString �쒕쾭濡� �꾩넚�� �곗씠��
        * @param callback �몄텧 �� �ㅽ뻾�� 肄쒕갚 �⑥닔
        */
        function asyncHttpRequest(reqType, url, async, queryString, callback) {
            if (window.XMLHttpRequest) {
                request = new XMLHttpRequest();
            } else if (window.ActiveXObject) {
                request = new ActiveXObject("MSXML2.XMLHTTP"); // IE 6 誘몃쭔
                if (!request) {
                    request = new ActiveXObject("Microsoft.XMLHTTP"); // IE 6 �댁긽
                }
            }
            if (request) {
                //�ㅼ쓬 2以꾩� IE 6 誘몃쭔�먯꽌 吏��먰븯吏� �딆쓬. 
                //request.onprogress = onProgress;	//�붿껌 �쒖옉�섎㈃ �섑뻾�섎뒗 �⑥닔 吏���
                //request.onload = onComplete;	//�붿껌�� �앸굹硫� �섑뻾�섎뒗 �⑥닔 吏���
                request.onreadystatechange = callback; //CallBack �⑥닔 吏��� 

                if (reqType.toLowerCase() == "post") {
                    // �꾩넚�� post 諛⑹떇�� 寃쎌슦
                    request.open(reqType, url, async);
                    request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
                    request.send(queryString);
                } else {
                    // �꾩넚�� get 諛⑹떇�� 寃쎌슦
                    request.open(reqType, url + "?" + queryString, async);
                    request.send(null);
                }
            } else {
                alert("Your web-broswer is not supported ajax call");
            }
        }
        /**
        * ajax �붿껌�� 吏꾪뻾�좊븣 �ㅽ뻾�섎뒗 �⑥닔.
        */
        function onProgress() {
            $('divLoadBody').setAttribute("style", "display:block;");
        }
        /**
        * ajax �붿껌�� �꾨즺�섎㈃ �ㅽ뻾�섎뒗 �⑥닔
        */
        function onComplete() {
            $('divLoadBody').setAttribute("style", "display:none;");
        }
        /**
        * form�� 紐⑤뱺 �낅젰而⑦듃濡ㅼ쓽 媛믪쓣 QueryString �뺥깭濡� 諛섑솚�섎뒗 �⑥닔
        * @returns queryString string����
        */
        function formSerialize() {
            var queryString = "";
            var frm = document.forms[0];
            var elementsLength = frm.elements.length;

            for (var i = 0; i < elementsLength; i++) {
                input = frm.elements[i];

                if (i < elementsLength - 1) {
                    queryString += input.name + "=" + encodeURIComponent(input.value) + "&";
                } else {
                    queryString += input.name + "=" + encodeURIComponent(input.value);
                }
            }
            return queryString;
        }

        function esselungaItemID(productCode) {
            var productCodeValue = '';

            if (productCode.substring(0, 1) == '2' && productCode.length == 13) { // EAN Fresh Food
                productCode = productCode.substring(0, 7) + '00000';
                productCodeValue = productCode + calculateCheckDigit_EAN13(productCode);
            } else if (productCode.substring(0, 2) == '02' && productCode.length == 12) { // UPC12 digits
                productCodeValue = '0' + productCode;
            } else {
                productCodeValue = productCode;
            }

            return productCodeValue;
        }

        function hoogvlietItemId(productCode) {
            var productCodeValue = productCode;

            if (productCode.length == 13) {
                if (productCode.substring(0, 2) == '21' || productCode.substring(0, 2) == '22') {
                    productCodeValue = productCode.substring(0, 6);
                } else if (productCode.substring(0, 2) == '23' || productCode.substring(0, 2) == '24') {
                    productCodeValue = productCode.substring(0, 7);
                }
            }

            if (productCode.substring(0, 1) == '0') {
                productCodeValue = productCode.substring(1, productCode.length);
            }

            return productCodeValue;
        }

        function calculateCheckDigit_EAN13(ean13) {
            var CD = -1;
            var oddSum = 0;
            var evenSum = 0;

            if (ean13.length == 12) {
                for (var nCnt = 0; nCnt < 12; nCnt++) {
                    var temp = ean13.substring(nCnt, nCnt + 1);
                    temp *= 1;
                    if (nCnt % 2 == 0) {
                        oddSum += temp;
                    } else {
                        evenSum += temp;
                    }
                }

                CD = 10 - ((oddSum + evenSum * 3) % 10);
            }

            return CD == 10 ? 0 : CD;
        }
    </script>
    <script>
        var contextPath = 'http://10.129.28.163:9001/PDA2';
        function inputList(event, obj) {
            if (event.keyCode == 13 && obj.value != '') {
                var barcodeNum = obj.value;
                finalBarcode = barcodeNum;
                asyncHttpRequest("GET", contextPath + '/readAmoreList', true, 'barcode=' + barcodeNum, inputListCallback);
            }
        }

        function inputListCallback() {
            if (request.readyState == 4) {
                // 문서 다운로드가 완료되었는가?
                if (request.status == 200) {
                    // 문서가 정상적으로 로드되었는가?
                    data = eval("(" + request.responseText + ")");

                    var size = data.length;
                    if (size >= 1) {
                        var itemTable = "<table width='100%' id='itemListTable'>";
                        itemTable += "<thead>";
                        itemTable += "<tr>";
                        itemTable += "<th>Article ID</th>";
                        itemTable += "<th>Product Name</th>";
                        itemTable += "<th>Price</th>";
                        itemTable += "</tr>";
                        itemTable += "</thead>";
                        itemTable += "<tbody>";

                        for (i = 0; i < size; i++) {
                            itemTable += "<tr>";
                            //itemTable+="<th>"+data[i].stationCode+"</th>";
                            itemTable += "<th>" + data[i].articleId + "</th>";
                            itemTable += "<th>" + data[i].name + "</th>";
                            itemTable += "<th>" + data[i].price + "</th>";
                            itemTable += "</tr>";
                        }

                        itemTable += "</tbody>";
                        itemTable += "</table>";

                        document.getElementById("itemList").innerHTML = itemTable;
                        document.getElementById("itemList").style.background = "#FFFFFF";
                    }

                    document.getElementById('itemListTable').onclick = function (event) {
                        //find click column
                        event = event || window.event;
                        var target = event.target || event.srcElement;
                        while (target && target.nodeName != 'TR') {
                            target = target.parentElement;
                        }
                        var cells = target.cells;
                        if (!cells.length || target.parentNode.nodeName == 'THEAD') {
                            return;
                        }

                        //change text/background color
                        var tbody = target.parentNode;
                        var trs = tbody.getElementsByTagName('tr');

                        for (var i = 0; i < trs.length; i++) {
                            if (trs[i] != target) {
                                trs[i].style.color = "black";
                            } else {
                                trs[i].style.color = "blue";
                            }
                        }

                        //write click column info
                        var articleId = cells[0].innerHTML;
                        var productName = cells[1].innerHTML;
                        var price = cells[2].innerHTML;
                        var productInfo = "Article ID: " + articleId + ", Product Name: " + productName + ", Price: " + price;

                        document.getElementById("itemName").innerHTML = productInfo;
                        document.getElementById("itemName").style.background = "#FFFFFF";

                        //$("itemId").value = articleId;
                        finalArticle = articleId;
                    }

                } else {
                    alert("");
                    //location.reload();
                }
            }
        }
    </script>
    <label>바코드</label><input type="text" onkeypress="javascript:inputList(event, this)" /><BR>
    <label>태그 ID</label><input type="text" />
    <div id="itemList"></div>
</body>

</html>
